# Конфигурация сборки (`build.config.json`)

Этот файл настраивает процесс сборки, управляемый скриптом `build.js`. Скрипт сборки можно запустить с пользовательским файлом конфигурации, используя флаг `--config`: `node build.js --config=my.build.json`.

---

## Основные параметры

### `outDir`
-   **Тип:** `String`
-   **Описание:** Путь к выходной директории для всех собранных файлов. Обычно это `"dist"`.
-   **Пример:** `"outDir": "dist"`

### `manifest`
-   **Тип:** `String`
-   **Описание:** Путь к файлу манифеста Google Apps Script (`appsscript.json`). Этот файл будет скопирован в корень `outDir`.
-   **Пример:** `"manifest": "src/appsscript.json"`

### `package`
-   **Тип:** `String`
-   **Описание:** Путь к файлу `package.json`. Используется для генерации баннера версии в объединенных файлах бэкенда.
-   **Пример:** `"package": "package.json"`

### `message`
-   **Тип:** `String` (необязательно)
-   **Описание:** Шаблон сообщения, которое будет отображаться после успешной операции `push` или `deploy`. Если опущено, будут показаны ссылки по умолчанию на развертывания веб-приложений.
-   **Переменные:**
    -   `{dev_id}`: Будет заменено идентификатором развертывания `@HEAD`.
    -   `{prod_id}`: Будет заменено идентификатором последнего производственного развертывания (`@version`). 
-   **Пример:** `"message": "Новая версия отправлена.\nDEV: https://script.google.com/macros/s/{dev_id}/dev\nPROD: https://script.google.com/macros/s/{prod_id}/exec"`

---

## `clasp`
-   **Тип:** `Object` (необязательно)
-   **Описание:** Если этот объект присутствует, файл `.clasp.json` будет сгенерирован в `outDir`, и все команды `clasp` (`push`, `deploy` и т.д.) будут выполняться из этой директории. Это позволяет использовать специфические для проекта конфигурации `clasp` без наличия файла `.clasp.json` в корневой директории проекта. Содержимое этого объекта записывается непосредственно в сгенерированный файл `.clasp.json`.
-   **Пример:**
    ```json
    "clasp": {
      "scriptId": "ВАШ_ИДЕНТИФИКАТОР_СКРИПТА",
      "rootDir": "."
    }
    ```

---

## `frontend`
-   **Тип:** `Object`
-   **Описание:** Конфигурация процесса сборки фронтенда (HTML, Svelte, CSS и т.д.).

### `frontend.build`
-   **Тип:** `Boolean`
-   **Описание:** Установите `true`, чтобы включить сборку фронтенда.
-   **Пример:** `"build": true`

### `frontend.src`
-   **Тип:** `String`
-   **Описание:** Путь к исходной директории для файлов фронтенда. Все остальные пути в конфигурации `frontend` указываются относительно этой директории. Сам путь `src` указывается относительно расположения файла `build.config.json`.
-   **Пример:** `"src": "src/frontend"`

### `frontend.minify`
-   **Тип:** `Boolean`
-   **Описание:** Установите `true`, чтобы минимизировать финальный вывод HTML, JS и CSS.
-   **Пример:** `"minify": true`

### `frontend.include`
-   **Тип:** `Array<String>` (необязательно)
-   **Описание:** Массив дополнительных файлов или директорий для включения в сборку фронтенда. Это аддитивно; все `.html` файлы внутри `frontend.src` уже включены по умолчанию. Пути указываются относительно `frontend.src`.
-   **Порядок обработки:**
    1.  Все `.html` файлы, найденные путем рекурсивного сканирования `frontend.src`, собираются первыми.
    2.  Затем добавляются файлы (или файлы, найденные внутри включенных директорий), указанные в `frontend.include`.
    3.  В случае конфликта имен для выходных файлов, к позднее добавленным файлам добавляется числовой суффикс (например, `file_1.html`).
-   **Правила для путей:**
    -   **Внутренние пути:** Файлы или папки внутри `frontend.src` (например, `"components/Login.html"`).
    -   **Внешние пути:** Файлы или папки вне `frontend.src` с использованием `../` (например, `"../common/header.html"`).
-   **Правила для вывода:**
    -   **Внутренние файлы:** Файлы, находящиеся в `frontend.src`, сохраняют свою структуру относительно `frontend.src` (например, `src/frontend/pages/About.html` становится `dist/pages/About.html`).
    -   **Внешние отдельные файлы:** Файлы, указанные напрямую (например, `"../common/header.html"`), помещаются в корень `outDir` (в результате `dist/header.html`). Вся часть пути до имени файла отбрасывается.
    -   **Внешние директории:** Для директорий (например, `"../libs/ui-components/"`) их *внутренняя* структура сохраняется относительно `outDir`. Например, для файла `../libs/ui-components/button.html` вывод будет `dist/button.html`. Часть пути, соответствующая самой включенной директории (`../libs/ui-components/`), удаляется из выходного пути.
-   **Пример:**
    ```json
    "include": [
      "dialogs/About.html",
      "../libs/ui-components/"
    ]
    ```

---

## `backend`
-   **Тип:** `Object`
-   **Описание:** Конфигурация процесса сборки бэкенда (`.js`, `.gs`).

### `backend.build`
-   **Тип:** `Boolean`
-   **Описание:** Установите `true`, чтобы включить сборку бэкенда.
-   **Пример:** `"build": true`

### `backend.src`
-   **Тип:** `String`
-   **Описание:** Путь к исходной директории для файлов бэкенда. Все остальные пути в конфигурации `backend` указываются относительно этой директории. Сам путь `src` указывается относительно расположения файла `build.config.json`.
-   **Пример:** `"src": "src/backend"`

### `backend.minify`
-   **Тип:** `Boolean`
-   **Описание:** Установите `true`, чтобы минимизировать код бэкенда.
-   **Пример:** `"minify": true`

### `backend.concatenate`
-   **Тип:** `Boolean`
-   **Описание:** Если `true`, все файлы бэкенда будут объединены в один файл, указанный в `outFile`. Если `false`, файлы будут обрабатываться по отдельности и сохранять свою структуру пути вывода в `outDir`.
-   **Пример:** `"concatenate": true`

### `backend.outFile`
-   **Тип:** `String`
-   **Описание:** Имя выходного файла, когда `concatenate` установлено в `true`.
-   **Пример:** `"outFile": "Code.js"`

### `backend.include`
-   **Тип:** `Array<String>` (необязательно)
-   **Описание:** Массив дополнительных файлов или директорий для включения в сборку бэкенда. Работает идентично `frontend.include`, но для файлов `.js` и `.gs`. Пути указываются относительно `backend.src`. Если `concatenate: false` и возникает конфликт имен для выходного файла, к имени конфликтующего файла будет добавлен числовой суффикс (например, `utils_1.js`).
-   **Пример:**
    ```json
    "include": [
      "utils/api.js",
      "../shared-libs/"
    ]
    ```

### `backend.priorityOrder`
-   **Тип:** `Array<String>` (необязательно)
-   **Описание:** **Этот параметр активен только при `concatenate: true`.** Он определяет точный порядок файлов в начале объединенного выходного файла. Все перечисленные здесь файлы будут автоматически включены в сборку. Пути указываются относительно `backend.src`.
-   **Порядок конкатенации (при `concatenate: true`):**
    1.  Файлы, указанные в `backend.priorityOrder`, размещаются первыми в точном порядке их появления в массиве.
    2.  Затем добавляются все остальные `.js` и `.gs` файлы, найденные путем рекурсивного сканирования `backend.src` (которые еще не были включены `priorityOrder`), отсортированные по алфавиту по их пути относительно `backend.src`.
    3.  Наконец, добавляются все оставшиеся `.js` и `.gs` файлы (или файлы, найденные внутри включенных директорий), указанные в `backend.include` (которые еще не были включены `priorityOrder` или `backend.src`), отсортированные по алфавиту по их пути относительно `backend.src`.
-   **Пример:**
    ```json
    "priorityOrder": [
      "../libs/Polyfill.js",
      "main.js"
    ]
    ```
